<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DANSH Grading System</title>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    /* ... The ENTIRE CSS from style (copy).css is embedded here ... */
    html, body {
      height: 100%;
      width: 100%;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #87CEEB 0%, #FFD700 100%);
    }
    
    /* ... Approximately 200 lines of CSS styles, including media queries ... */
    
    @media (max-width: 480px) {
      .header h1 {
        font-size: 14px;
      }

      .btn-logout {
        padding: 8px 12px;
        font-size: 12px;
      }
    }
  </style>

</head>
<body>
  <div id="auth-container" class="container active">
    <div id="login-form" class="auth-form active">
      <h1>DANSH Grading System</h1>
      <h2>Login</h2>
      <form id="loginForm">
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="login-email" required>
        </div>
        <div class="form-group">
          <label>Password</label>
          <div class="password-input">
            <input type="password" id="login-password" required>
            <button type="button" class="toggle-password" onclick="togglePassword('login-password')">üëÅÔ∏è</button>
          </div>
        </div>
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="remember-me">
            Remember Me
          </label>
        </div>
        <button type="submit" class="btn-primary">Login</button>
        <p class="toggle-form">Don't have an account? <a href="#" onclick="toggleAuthForm()">Sign Up</a></p>
      </form>
    </div>

    <div id="signup-form" class="auth-form">
      <h1>DANSH Grading System</h1>
      <h2>Student Sign Up</h2>
      <form id="signupForm">
        <div class="form-group">
          <label>Full Name *</label>
          <input type="text" id="signup-fullname" required>
        </div>
        <div class="form-group">
          <label>Email *</label>
          <input type="email" id="signup-email" required>
        </div>
        <div class="form-group">
          <label>Password *</label>
          <div class="password-input">
            <input type="password" id="signup-password" required minlength="6">
            <button type="button" class="toggle-password" onclick="togglePassword('signup-password')">üëÅÔ∏è</button>
          </div>
          <div class="password-strength" id="password-strength"></div>
        </div>
        <div class="form-group">
          <label>Confirm Password *</label>
          <div class="password-input">
            <input type="password" id="signup-confirm-password" required minlength="6">
            <button type="button" class="toggle-password" onclick="togglePassword('signup-confirm-password')">üëÅÔ∏è</button>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Grade Level *</label>
            <select id="signup-grade" required>
              <option value="">Select Grade</option>
              <option value="7">Grade 7</option>
              <option value="8">Grade 8</option>
              <option value="9">Grade 9</option>
              <option value="10">Grade 10</option>
              <option value="11">Grade 11</option>
              <option value="12">Grade 12</option>
            </select>
          </div>
          <div class="form-group">
            <label>Section *</label>
            <select id="signup-section" required>
              <option value="">Select Section</option>
              <option value="A">A</option>
              <option value="B">B</option>
              <option value="C">C</option>
              <option value="D">D</option>
            </select>
          </div>
                </div>

          <div class="form-group">
          <label>Parent/Guardian Name *</label>
          <input type="text" id="signup-parent-name" required>
        </div>
        <div class="form-group">
          <label>Parent/Guardian Phone Number *</label>
          <input type="tel" id="signup-parent-phone" required>
        </div>
        <div class="form-group">
          <label>Student's Address *</label>
          <textarea id="signup-address" required rows="3"></textarea>
        </div>
        <button type="submit" class="btn-primary">Sign Up</button>
        <p class="toggle-form">Already have an account? <a href="#" onclick="toggleAuthForm()">Login</a></p>
      </form>
    </div>
  </div> <div id="dashboard-container" class="container">
    <header class="header">
      <button class="hamburger" onclick="toggleSidebar()">‚ò∞</button>
      <h1 id="welcome-message">WELCOME TO DANSH GRADING SYSTEM</h1>
      <button class="btn-logout" onclick="logout()">Logout</button>
    </header>

    <aside id="sidebar" class="sidebar">
      <div class="sidebar-content">
        <h3>Navigation</h3>
        <nav id="student-nav" class="nav-menu">
          <a href="#" onclick="showPanel('grades')">üìä Grades</a>
          <a href="#" onclick="showPanel('profile')">üë§ Profile</a>
          <a href="#" onclick="logout()">üö™ Logout</a>
        </nav>
        <nav id="admin-nav" class="nav-menu" style="display:none;">
          <a href="#" onclick="showPanel('grades')">üìä Grades List</a>
          <a href="#" onclick="showPanel('users')">üë• User List</a>
          <a href="#" onclick="showPanel('profile')">üë§ Profile</a>
          <a href="#" onclick="showPanel('add-grades')">‚ûï Add Grades</a>
          <a href="#" onclick="showPanel('add-admin')">üë®‚Äçüíº Add Admin Account</a>
          <a href="#" onclick="showPanel('delete-users')">üóëÔ∏è Delete Members</a>
          <a href="#" onclick="logout()">üö™ Logout</a>
        </nav>
      </div>
    </aside>

    <main class="main-content">
      <div id="grades-panel" class="panel active">
        <div class="panel-header">
          <h2>Grades</h2>
          <div class="zoom-buttons">
            <button class="btn-zoom" onclick="zoomIn('grades-table-container')">üîç Zoom In</button>
            <button class="btn-zoom-out" onclick="zoomOut('grades-table-container')" style="display:none;">‚Ü©Ô∏è Zoom Out</button>
          </div>
        </div>
        <div id="grades-table-container" class="table-container">
          <table id="grades-table">
            <thead>
              <tr>
                <th>Student Name</th>
                <th>Level</th>
                <th>Section</th>
                <th>Subject</th>
                <th>Grade</th>
                <th>Status</th>
                <th class="admin-only" style="display:none;">Actions</th>
              </tr>
            </thead>
            <tbody id="grades-tbody">
              <tr><td colspan="7">Loading...</td></tr>
            </tbody>
          </table>
        </div>
                </div>

        <div id="users-panel" class="panel">
        <div class="panel-header">
          <h2>User Management</h2>
          <div class="zoom-buttons">
            <button class="btn-zoom" onclick="zoomIn('users-table-container')">üîç Zoom In</button>
            <button class="btn-zoom-out" onclick="zoomOut('users-table-container')" style="display:none;">‚Ü©Ô∏è Zoom Out</button>
          </div>
        </div>
        <div class="search-container">
          <input type="text" id="user-search" placeholder="Search users..." oninput="filterUsers()">
        </div>
        <div id="users-table-container" class="table-container">
          <table id="users-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Level</th>
                <th>Section</th>
                <th>Role</th>
              </tr>
            </thead>
            <tbody id="users-tbody">
              <tr><td colspan="5">Loading...</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div id="profile-panel" class="panel">
        <div class="panel-header">
          <h2>Profile</h2>
        </div>
        <form id="profile-form" class="profile-form">
          <div class="form-group">
            <label>Full Name</label>
            <input type="text" id="profile-fullname" required>
          </div>
          <div class="form-group">
            <label>Mobile Number</label>
            <input type="tel" id="profile-mobile">
          </div>
          <div class="form-group">
            <label>Purok</label>
            <input type="text" id="profile-purok">
          </div>
          <div class="form-group">
            <label>Address</label>
            <textarea id="profile-address" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label>Parent/Guardian Name</label>
            <input type="text" id="profile-parent-name">
          </div>
          <div class="form-group">
            <label>Parent/Guardian Phone</label>
            <input type="tel" id="profile-parent-phone">
          </div>
          <button type="submit" class="btn-primary">Update Profile</button>
        </form>
      </div>

        <div id="add-grades-panel" class="panel">
        <div class="panel-header">
          <h2>Add/Edit Grades</h2>
        </div>
        <form id="add-grade-form" class="grade-form">
          <input type="hidden" id="edit-grade-id">
          <div class="form-group">
            <label>Select Student</label>
            <select id="grade-student" required>
              <option value="">Select Student</option>
            </select>
          </div>
          <div class="form-group">
            <label>Subject</label>
            <input type="text" id="grade-subject" required>
          </div>
          <div class="form-group">
            <label>Grade (0-100)</label>
            <input type="number" id="grade-value" min="0" max="100" required>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn-primary">Save Grade</button>
            <button type="button" class="btn-secondary" onclick="cancelEditGrade()">Cancel</button>
          </div>
        </form>
      </div>

      <div id="add-admin-panel" class="panel">
        <div class="panel-header">
          <h2>Create Admin Account</h2>
        </div>
        <form id="add-admin-form" class="admin-form">
          <div class="form-group">
            <label>Admin Email</label>
            <input type="email" id="admin-email" required>
          </div>
          <div class="form-group">
            <label>Password</label>
            <div class="password-input">
              <input type="password" id="admin-password" required minlength="6">
              <button type="button" class="toggle-password" onclick="togglePassword('admin-password')">üëÅÔ∏è</button>
            </div>
            <div class="password-strength" id="admin-password-strength"></div>
          </div>
          <div class="form-group">
            <label>Full Name</label>
            <input type="text" id="admin-fullname" required>
          </div>
          <button type="submit" class="btn-primary">Create Admin</button>
        </form>
      </div>

      <div id="delete-users-panel" class="panel">
        <div class="panel-header">
          <h2>Delete Members</h2>
          <div class="zoom-buttons">
            <button class="btn-zoom" onclick="zoomIn('delete-users-table-container')">üîç Zoom In</button>
            <button class="btn-zoom-out" onclick="zoomOut('delete-users-table-container')" style="display:none;">‚Ü©Ô∏è Zoom Out</button>
          </div>
        </div>
        <div id="delete-users-table-container" class="table-container">
          <table id="delete-users-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Role</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="delete-users-tbody">
              <tr><td colspan="4">Loading...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </main> </div> <div id="loading-overlay" class="loading-overlay">
    <div class="spinner"></div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>


      <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCYPONQgJC33Lp2OmMyKw4hssDStEwvPlQ",
      authDomain: "test-9c727.firebaseapp.com",
      projectId: "test-9c727",
      storageBucket: "test-9c727.firebasestorage.app",
      messagingSenderId: "198578631587",
      appId: "1:198578631587:web:c0831122f964d46149e016"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let currentUser = null;
    let currentUserProfile = null;
    let secondaryApp = null;

    auth.onAuthStateChanged(async (user) => {
      if (user) {
        currentUser = user;
        await loadUserProfile();
        showDashboard();
      } else {
        showAuth();
      }
    });

    async function loadUserProfile() {
      try {
        const doc = await db.collection('profiles').doc(currentUser.uid).get();
        if (doc.exists) {
          currentUserProfile = { id: doc.id, ...doc.data() };
          updateWelcomeMessage();
          if (currentUserProfile.role === 'admin') {
            showAdminNav();
          } else {
            showStudentNav();
          }
        }
      } catch (error) {
        console.error('Error loading profile:', error);
      }
    }

    function updateWelcomeMessage() {
      const welcomeMsg = document.getElementById('welcome-message');
      if (currentUserProfile) {
        const role = currentUserProfile.role === 'admin' ? 'ADMIN' : 'STUDENT';
        welcomeMsg.textContent = `WELCOME TO DANSH GRADING SYSTEM ‚Äì ${currentUserProfile.fullName.toUpperCase()} / ${role}`;
      }
    }

    function showAuth() {
      document.getElementById('auth-container').classList.add('active');
      document.getElementById('dashboard-container').classList.remove('active');
      hideLoading();
    }

    function showDashboard() {
      document.getElementById('auth-container').classList.remove('active');
      document.getElementById('dashboard-container').classList.add('active');
      showPanel('grades');
      hideLoading();
    }

    function showAdminNav() {
      document.getElementById('student-nav').style.display = 'none';
      document.getElementById('admin-nav').style.display = 'block';
      document.querySelectorAll('.admin-only').forEach(el => el.style.display = '');
    }

    function showStudentNav() {
      document.getElementById('student-nav').style.display = 'block';
      document.getElementById('admin-nav').style.display = 'none';
      document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'none');
    }

    function toggleAuthForm() {
      const loginForm = document.getElementById('login-form');
      const signupForm = document.getElementById('signup-form');
      loginForm.classList.toggle('active');
      signupForm.classList.toggle('active');
    }

    function togglePassword(inputId) {
      const input = document.getElementById(inputId);
      input.type = input.type === 'password' ? 'text' : 'password';
    }

    function checkPasswordStrength(password) {
      let strength = 'weak';
      if (password.length >= 8) {
        if (/[A-Z]/.test(password) && /[0-9]/.test(password) && /[^A-Za-z0-9]/.test(password)) {
          strength = 'strong';
        } else if (/[A-Z]/.test(password) || /[0-9]/.test(password)) {
          strength = 'medium';
        }
      }
      return strength;
    }

    document.getElementById('signup-password').addEventListener('input', (e) => {
      const strength = checkPasswordStrength(e.target.value);
      const strengthEl = document.getElementById('password-strength');
      strengthEl.textContent = `Password strength: ${strength}`;
      strengthEl.className = 'password-strength ' + strength;
    });

    document.getElementById('admin-password').addEventListener('input', (e) => {
      const strength = checkPasswordStrength(e.target.value);
      const strengthEl = document.getElementById('admin-password-strength');
      strengthEl.textContent = `Password strength: ${strength}`;
      strengthEl.className = 'password-strength ' + strength;
    });
    
    // ... continued in Part 2

              // ... continued from Part 1

    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;
      const rememberMe = document.getElementById('remember-me').checked;
      
      showLoading();
      try {
        const persistence = rememberMe ? firebase.auth.Auth.Persistence.LOCAL : firebase.auth.Auth.Persistence.SESSION;
        await auth.setPersistence(persistence);
        await auth.signInWithEmailAndPassword(email, password);
        showAlert('Login successful!', 'success');
      } catch (error) {
        hideLoading();
        showAlert(error.message, 'error');
      }
    });

    document.getElementById('signupForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const password = document.getElementById('signup-password').value;
      const confirmPassword = document.getElementById('signup-confirm-password').value;
      
      if (password !== confirmPassword) {
        showAlert('Passwords do not match!', 'error');
        return;
      }
      
      const userData = {
        email: document.getElementById('signup-email').value,
        fullName: document.getElementById('signup-fullname').value,
        gradeLevel: document.getElementById('signup-grade').value,
        section: document.getElementById('signup-section').value,
        parentName: document.getElementById('signup-parent-name').value,
        parentPhone: document.getElementById('signup-parent-phone').value,
        address: document.getElementById('signup-address').value,
        role: 'student'
      };
      
      showLoading();
      try {
        const userCredential = await auth.createUserWithEmailAndPassword(userData.email, password);
        await db.collection('profiles').doc(userCredential.user.uid).set(userData);
        showAlert('Account created successfully!', 'success');
      } catch (error) {
        hideLoading();
        showAlert(error.message, 'error');
      }
    });

    document.getElementById('profile-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const profileData = {
        fullName: document.getElementById('profile-fullname').value,
        mobile: document.getElementById('profile-mobile').value,
        purok: document.getElementById('profile-purok').value,
        address: document.getElementById('profile-address').value,
        parentName: document.getElementById('profile-parent-name').value,
        parentPhone: document.getElementById('profile-parent-phone').value
      };
      
      showLoading();
      try {
        await db.collection('profiles').doc(currentUser.uid).update(profileData);
        currentUserProfile = { ...currentUserProfile, ...profileData };
        updateWelcomeMessage();
        await loadGrades();
        showAlert('Profile updated successfully!', 'success');
        hideLoading();
      } catch (error) {
        hideLoading();
        showAlert(error.message, 'error');
      }
    });
    
    // ... continued in Part 3

              // ... continued from Part 2

    document.getElementById('add-grade-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const studentId = document.getElementById('grade-student').value;
      const subject = document.getElementById('grade-subject').value;
      const grade = parseInt(document.getElementById('grade-value').value);
      const editId = document.getElementById('edit-grade-id').value;
      
      if (grade < 0 || grade > 100) {
        showAlert('Grade must be between 0 and 100!', 'error');
        return;
      }
      
      const studentDoc = await db.collection('profiles').doc(studentId).get();
      const studentData = studentDoc.data();
      
      const gradeData = {
        studentId,
        studentName: studentData.fullName,
        gradeLevel: studentData.gradeLevel,
        section: studentData.section,
        subject,
        grade,
        status: grade >= 75 ? 'Passed' : 'Failed'
      };
      
      showLoading();
      try {
        if (editId) {
          await db.collection('grades').doc(editId).update(gradeData);
          showAlert('Grade updated successfully!', 'success');
        } else {
          await db.collection('grades').add(gradeData);
          showAlert('Grade added successfully!', 'success');
        }
        document.getElementById('add-grade-form').reset();
        document.getElementById('edit-grade-id').value = '';
        await loadGrades();
        hideLoading();
      } catch (error) {
        hideLoading();
        showAlert(error.message, 'error');
      }
    });

    document.getElementById('add-admin-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const email = document.getElementById('admin-email').value;
      const password = document.getElementById('admin-password').value;
      const fullName = document.getElementById('admin-fullname').value;
      
      showLoading();
      try {
        if (!secondaryApp) {
          secondaryApp = firebase.initializeApp(firebaseConfig, 'secondary');
        }
        
        const secondaryAuth = secondaryApp.auth();
        const userCredential = await secondaryAuth.createUserWithEmailAndPassword(email, password);
        
        await db.collection('profiles').doc(userCredential.user.uid).set({
          email,
          fullName,
          role: 'admin'
        });
        
        await secondaryAuth.signOut();
        
        showAlert('Admin account created successfully!', 'success');
        document.getElementById('add-admin-form').reset();
        hideLoading();
      } catch (error) {
        hideLoading();
        showAlert(error.message, 'error');
      }
    });

    async function loadGrades() {
      const tbody = document.getElementById('grades-tbody');
      tbody.innerHTML = '<tr><td colspan="7">Loading...</td></tr>';
      
      try {
        let query = db.collection('grades');
        
        if (currentUserProfile.role === 'student') {
          query = query.where('gradeLevel', '==', currentUserProfile.gradeLevel)
                       .where('section', '==', currentUserProfile.section);
        }
        
        const snapshot = await query.get();
        
        if (snapshot.empty) {
          tbody.innerHTML = '<tr><td colspan="7">No grades found</td></tr>';
          return;
        }
        
        tbody.innerHTML = '';
        snapshot.forEach(doc => {
          const grade = doc.data();
          const row = tbody.insertRow();
          row.innerHTML = `
            <td>${grade.studentName}</td>
            <td>Grade ${grade.gradeLevel}</td>
            <td>${grade.section}</td>
            <td>${grade.subject}</td>
            <td>${grade.grade}</td>
            <td class="${grade.status === 'Passed' ? 'status-passed' : 'status-failed'}">${grade.status}</td>
            <td class="admin-only" style="${currentUserProfile.role === 'admin' ? '' : 'display:none;'}">
              <button class="btn-edit" onclick="editGrade('${doc.id}')">Edit</button>
              <button class="btn-delete" onclick="deleteGrade('${doc.id}')">Delete</button>
            </td>
          `;
        });
      } catch (error) {
        tbody.innerHTML = '<tr><td colspan="7">Error loading grades</td></tr>';
        console.error('Error loading grades:', error);
      }
    }

    async function editGrade(gradeId) {
      try {
        const doc = await db.collection('grades').doc(gradeId).get();
        const grade = doc.data();
        
        document.getElementById('edit-grade-id').value = gradeId;
        document.getElementById('grade-student').value = grade.studentId;
        document.getElementById('grade-subject').value = grade.subject;
        document.getElementById('grade-value').value = grade.grade;
        
        showPanel('add-grades');
      } catch (error) {
        showAlert('Error loading grade for editing', 'error');
      }
    }

    async function deleteGrade(gradeId) {
      if (!confirm('Are you sure you want to delete this grade?')) return;
      
      showLoading();
      try {
        await db.collection('grades').doc(gradeId).delete();
        showAlert('Grade deleted successfully!', 'success');
        await loadGrades();
        hideLoading();
      } catch (error) {
        hideLoading();
        showAlert(error.message, 'error');
      }
    }

    function cancelEditGrade() {
      document.getElementById('add-grade-form').reset();
      document.getElementById('edit-grade-id').value = '';
    }

    // ... continued in Part 4

              // ... continued from Part 3

    async function loadUsers() {
      const tbody = document.getElementById('users-tbody');
      tbody.innerHTML = '<tr><td colspan="5">Loading...</td></tr>';
      
      try {
        const snapshot = await db.collection('profiles').get();
        
        if (snapshot.empty) {
          tbody.innerHTML = '<tr><td colspan="5">No users found</td></tr>';
          return;
        }
        
        tbody.innerHTML = '';
        snapshot.forEach(doc => {
          const user = doc.data();
          const row = tbody.insertRow();
          row.innerHTML = `
            <td>${user.fullName || 'N/A'}</td>
            <td>${user.email}</td>
            <td>${user.gradeLevel ? 'Grade ' + user.gradeLevel : 'N/A'}</td>
            <td>${user.section || 'N/A'}</td>
            <td>${user.role === 'admin' ? 'Admin' : 'Student'}</td>
          `;
        });
      } catch (error) {
        tbody.innerHTML = '<tr><td colspan="5">Error loading users</td></tr>';
        console.error('Error loading users:', error);
      }
    }

    async function loadDeleteUsers() {
      const tbody = document.getElementById('delete-users-tbody');
      tbody.innerHTML = '<tr><td colspan="4">Loading...</td></tr>';
      
      try {
        const snapshot = await db.collection('profiles').get();
        
        if (snapshot.empty) {
          tbody.innerHTML = '<tr><td colspan="4">No users found</td></tr>';
          return;
        }
        
        tbody.innerHTML = '';
        snapshot.forEach(doc => {
          const user = doc.data();
          if (doc.id === currentUser.uid) return;
          
          const row = tbody.insertRow();
          row.innerHTML = `
            <td>${user.fullName || 'N/A'}</td>
            <td>${user.email}</td>
            <td>${user.role === 'admin' ? 'Admin' : 'Student'}</td>
            <td>
              <button class="btn-delete" onclick="deleteUser('${doc.id}')">Delete</button>
            </td>
          `;
        });
      } catch (error) {
        tbody.innerHTML = '<tr><td colspan="4">Error loading users</td></tr>';
        console.error('Error loading users:', error);
      }
    }

    async function deleteUser(userId) {
      if (!confirm('Are you sure you want to delete this user and all their grades?')) return;
      
      showLoading();
      try {
        await db.collection('profiles').doc(userId).delete();
        
        const gradesSnapshot = await db.collection('grades').where('studentId', '==', userId).get();
        const batch = db.batch();
        gradesSnapshot.forEach(doc => {
          batch.delete(doc.ref);
        });
        await batch.commit();
        
        showAlert('User and their grades deleted successfully!', 'success');
        await loadDeleteUsers();
        await loadUsers();
        hideLoading();
      } catch (error) {
        hideLoading();
        showAlert(error.message, 'error');
      }
    }

    function filterUsers() {
      const searchTerm = document.getElementById('user-search').value.toLowerCase();
      const rows = document.querySelectorAll('#users-tbody tr');
      
      rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? '' : 'none';
      });
    }

    async function loadStudentsForGrades() {
      const select = document.getElementById('grade-student');
      select.innerHTML = '<option value="">Select Student</option>';
      
      try {
        const snapshot = await db.collection('profiles').where('role', '==', 'student').get();
        snapshot.forEach(doc => {
          const student = doc.data();
          const option = document.createElement('option');
          option.value = doc.id;
          option.textContent = `${student.fullName} - Grade ${student.gradeLevel}${student.section}`;
          select.appendChild(option);
        });
      } catch (error) {
        console.error('Error loading students:', error);
      }
    }

    async function loadProfileData() {
      if (!currentUserProfile) return;
      
      document.getElementById('profile-fullname').value = currentUserProfile.fullName || '';
      document.getElementById('profile-mobile').value = currentUserProfile.mobile || '';
      document.getElementById('profile-purok').value = currentUserProfile.purok || '';
      document.getElementById('profile-address').value = currentUserProfile.address || '';
      document.getElementById('profile-parent-name').value = currentUserProfile.parentName || '';
      document.getElementById('profile-parent-phone').value = currentUserProfile.parentPhone || '';
    }

    // ... continued in Part 5

              // ... continued from Part 4

    function showPanel(panelName) {
      document.querySelectorAll('.panel').forEach(panel => panel.classList.remove('active'));
      
      const panels = {
        'grades': 'grades-panel',
        'users': 'users-panel',
        'profile': 'profile-panel',
        'add-grades': 'add-grades-panel',
        'add-admin': 'add-admin-panel',
        'delete-users': 'delete-users-panel'
      };
      
      const panelId = panels[panelName];
      if (panelId) {
        document.getElementById(panelId).classList.add('active');
        
        if (panelName === 'grades') loadGrades();
        else if (panelName === 'users') loadUsers();
        else if (panelName === 'profile') loadProfileData();
        else if (panelName === 'add-grades') loadStudentsForGrades();
        else if (panelName === 'delete-users') loadDeleteUsers();
      }
      
      if (window.innerWidth <= 768) {
        document.getElementById('sidebar').classList.remove('active');
      }
    }

    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('active');
    }

    function zoomIn(containerId) {
      const container = document.getElementById(containerId);
      container.classList.add('zoomed');
      
      const panel = container.closest('.panel');
      const zoomInBtn = panel.querySelector('.btn-zoom');
      const zoomOutBtn = panel.querySelector('.btn-zoom-out');
      
      if (zoomInBtn) zoomInBtn.style.display = 'none';
      if (zoomOutBtn) zoomOutBtn.style.display = 'inline-block';
    }

    function zoomOut(containerId) {
      const container = document.getElementById(containerId);
      container.classList.remove('zoomed');
      
      const panel = container.closest('.panel');
      const zoomInBtn = panel.querySelector('.btn-zoom');
      const zoomOutBtn = panel.querySelector('.btn-zoom-out');
      
      if (zoomInBtn) zoomInBtn.style.display = 'inline-block';
      if (zoomOutBtn) zoomOutBtn.style.display = 'none';
    }

    async function logout() {
      if (confirm('Are you sure you want to logout?')) {
        showLoading();
        await auth.signOut();
        document.getElementById('login-email').value = '';
        document.getElementById('login-password').value = '';
        showAlert('Logged out successfully!', 'success');
      }
    }

    function showLoading() {
      document.getElementById('loading-overlay').classList.add('active');
    }

    function hideLoading() {
      document.getElementById('loading-overlay').classList.remove('active');
    }

    function showAlert(message, type) {
      const alertDiv = document.createElement('div');
      alertDiv.className = `alert alert-${type}`;
      alertDiv.textContent = message;
      document.body.appendChild(alertDiv);
      
      setTimeout(() => {
        alertDiv.classList.add('show');
      }, 10);
      
      setTimeout(() => {
        alertDiv.classList.remove('show');
        setTimeout(() => alertDiv.remove(), 300);
      }, 3000);
    }

    if (window.innerWidth <= 768) {
      document.addEventListener('click', (e) => {
        const sidebar = document.getElementById('sidebar');
        const hamburger = document.querySelector('.hamburger');
        if (sidebar && hamburger && sidebar.classList.contains('active') && 
            !sidebar.contains(e.target) && !hamburger.contains(e.target)) {
          sidebar.classList.remove('active');
        }
      });
    }
  </script>
</body>
</html>
