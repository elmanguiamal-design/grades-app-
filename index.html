<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>School Grades System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial, sans-serif; margin: 10px; }
h2,h3 { color: #333; }
input,button,select { margin:5px;padding:8px;width:95%;max-width:300px; }
button { background:#007bff;color:white;border:none;border-radius:4px; cursor:pointer; }
button:hover { background:#0056b3; }
#gradesTables { margin-top:15px; }
table { border-collapse: collapse; width: 100%; margin-bottom: 15px; }
th, td { border:1px solid #ccc; padding:5px; text-align:left; }
.hidden { display:none; }
.strength { font-weight:bold; margin-left:5px; }
.showpass { cursor:pointer; color:#007bff; margin-left:5px; font-size:0.9em; }
</style>
</head>
<body>

<h2>ðŸ“š School Grades System</h2>

<!-- SIGNUP/LOGIN WIZARD -->
<div id="loginSection">
  <h3>Student Signup / Login</h3>
  
  <!-- Step 1: Email -->
  <div id="step1">
    <input id="email" placeholder="Email" type="email"><br>
    <button id="nextStep1">Next</button>
  </div>
  
  <!-- Step 2: Password -->
  <div id="step2" class="hidden">
    <input id="password" placeholder="Password" type="password">
    <span id="strength" class="strength"></span>
    <span id="togglePassword" class="showpass">Show</span><br>
    <button id="nextStep2">Next</button>
    <button id="backStep2">Back</button>
  </div>
  
  <!-- Step 3: Confirm -->
  <div id="step3" class="hidden">
    <input id="confirmPassword" placeholder="Confirm Password" type="password">
    <span id="toggleConfirm" class="showpass">Show</span><br>
    <button id="signup">Sign Up</button>
    <button id="backStep3">Back</button>
  </div>
  
  <hr>
  <input id="loginEmail" placeholder="Login Email" type="email">
  <input id="loginPassword" placeholder="Login Password" type="password">
  <span id="toggleLogin" class="showpass">Show</span><br>
  <button id="login">Login</button>
</div>

<!-- APP SECTION -->
<div id="appSection" class="hidden">
  <h3>Welcome, <span id="userEmailDisplay"></span> (<span id="userLevelSection"></span>)</h3>
  <button id="logout">Logout</button>
  
  <!-- Admin Panel -->
  <div id="adminSection" class="hidden">
    <h3>Grades Management</h3>
    <input id="studentName" placeholder="Student Name">
    <select id="gradeLevel">
      <option value="7">Level 7</option>
      <option value="8">Level 8</option>
      <option value="9">Level 9</option>
      <option value="10">Level 10</option>
      <option value="11">Level 11</option>
      <option value="12">Level 12</option>
    </select>
    <select id="gradeSectionSelect">
      <option value="Juan">Juan</option>
      <option value="Mamaw">Mamaw</option>
    </select>
    <input id="subject" placeholder="Subject">
    <input id="grade" placeholder="Grade">
    <button id="saveGrade">Save Grade</button>
    
    <h3>Assign Student to Section</h3>
    <input id="studentEmailAssign" placeholder="Student Email">
    <select id="assignLevel">
      <option value="7">Level 7</option>
      <option value="8">Level 8</option>
      <option value="9">Level 9</option>
      <option value="10">Level 10</option>
      <option value="11">Level 11</option>
      <option value="12">Level 12</option>
    </select>
    <select id="assignSection">
      <option value="Juan">Juan</option>
      <option value="Mamaw">Mamaw</option>
    </select>
    <button id="assignStudent">Assign</button>
    
    <h3>Rename Section</h3>
    <select id="renameLevel">
      <option value="7">Level 7</option>
      <option value="8">Level 8</option>
      <option value="9">Level 9</option>
      <option value="10">Level 10</option>
      <option value="11">Level 11</option>
      <option value="12">Level 12</option>
    </select>
    <select id="renameSectionSelect">
      <option value="Juan">Juan</option>
      <option value="Mamaw">Mamaw</option>
    </select>
    <input id="newSectionName" placeholder="New Section Name">
    <button id="renameSectionBtn">Rename Section</button>
  </div>
  
  <!-- Grades Display -->
  <div id="gradesTables"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, addDoc, collection, getDocs, updateDoc } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyCYPONQgJC33Lp2OmMyKw4hssDStEwvPlQ",
  authDomain: "test-9c727.firebaseapp.com",
  projectId: "test-9c727",
  storageBucket: "test-9c727.firebasestorage.app",
  messagingSenderId: "198578631587",
  appId: "1:198578631587:web:c97a46805e01441b49e016"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// Admin email
const ADMIN_EMAIL = "enzo@gmail.com";
let currentUserLevel = "";
let currentUserSection = "";

// ELEMENTS
const step1 = document.getElementById('step1');
const step2 = document.getElementById('step2');
const step3 = document.getElementById('step3');
const emailInput = document.getElementById('email');
const passwordInput = document.getElementById('password');
const confirmPasswordInput = document.getElementById('confirmPassword');
const strengthSpan = document.getElementById('strength');
const togglePassword = document.getElementById('togglePassword');
const toggleConfirm = document.getElementById('toggleConfirm');
const toggleLogin = document.getElementById('toggleLogin');

// Password show/hide
togglePassword.onclick = () => {
  passwordInput.type = passwordInput.type==='password'?'text':'password';
  togglePassword.textContent = passwordInput.type==='password'?'Show':'Hide';
};
toggleConfirm.onclick = () => {
  confirmPasswordInput.type = confirmPasswordInput.type==='password'?'text':'password';
  toggleConfirm.textContent = confirmPasswordInput.type==='password'?'Show':'Hide';
};
const loginPassword = document.getElementById('loginPassword');
toggleLogin.onclick = () => {
  loginPassword.type = loginPassword.type==='password'?'text':'password';
  toggleLogin.textContent = loginPassword.type==='password'?'Show':'Hide';
};

// Password strength checker
passwordInput.oninput = () => {
  const val = passwordInput.value;
  let strength = "Weak";
  if(val.length>=8 && /[A-Z]/.test(val) && /[0-9]/.test(val)) strength="Strong";
  else if(val.length>=6) strength="Medium";
  strengthSpan.textContent = strength;
  strengthSpan.style.color = strength==="Strong"?"green":strength==="Medium"?"orange":"red";
};

// STEP navigation
document.getElementById('nextStep1').onclick = () => {
  if(!emailInput.value.includes('@')) { alert("Enter valid email"); return; }
  step1.classList.add('hidden'); step2.classList.remove('hidden');
};
document.getElementById('backStep2').onclick = () => { step2.classList.add('hidden'); step1.classList.remove('hidden'); };
document.getElementById('nextStep2').onclick = () => {
  if(passwordInput.value.length<6){alert("Password too short"); return;}
  step2.classList.add('hidden'); step3.classList.remove('hidden');
};
document.getElementById('backStep3').onclick = () => { step3.classList.add('hidden'); step2.classList.remove('
