<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DANHS School Grades</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background: #f9f9f9;
  }
  header {
    background: #004080;
    color: white;
    padding: 10px 20px;
    display: flex;
    align-items: center;
  }
  #menuBtn {
    font-size: 24px;
    cursor: pointer;
    margin-right: 15px;
  }
  h1 { margin: 0; font-size: 20px; }

  /* Side menu */
  #sideMenu {
    position: fixed;
    top: 0; left: -250px;
    width: 250px; height: 100%;
    background: #333; color: white;
    padding-top: 60px;
    transition: 0.3s;
    z-index: 1000;
  }
  #sideMenu a {
    display: block;
    padding: 12px;
    color: white;
    text-decoration: none;
  }
  #sideMenu a:hover { background: #575757; }
  .panel {
    display: none;
    padding: 20px;
    background: white;
    margin: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  }
  .close-btn {
    float: right;
    cursor: pointer;
    color: red;
  }
  .btn-primary {
    background: #004080;
    color: white;
    border: none;
    padding: 8px 12px;
    margin-top: 10px;
    cursor: pointer;
    border-radius: 5px;
  }
  .btn-primary:hover { background: #0066cc; }
  table {
    width: 100%; border-collapse: collapse; margin-top: 15px;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: left;
  }
  th { background: #eee; }
</style>
</head>
<body>

<header>
  <span id="menuBtn">‚ò∞</span>
  <h1>DANHS School Grades</h1>
</header>

<!-- Side Menu -->
<div id="sideMenu">
  <a href="#" onclick="openPanel('gradesPanel')">üìä Grades</a>
  <a href="#" onclick="openPanel('usersPanel')">üë• All Users</a>
  <a href="#" onclick="openPanel('addAdminPanel')">‚ûï Add Admin</a>
  <a href="#" onclick="openPanel('deleteMemberPanel')">üóëÔ∏è Delete Member</a>
  <a href="#" onclick="openPanel('infoPanel')">‚öôÔ∏è My Info</a>
  <a href="#" onclick="logout()">üö™ Logout</a>
</div>

<!-- Signup Form -->
<div id="signupDiv" class="panel" style="display:block;">
  <h2>Signup</h2>
  <input type="text" id="signupName" placeholder="Full Name"><br>
  <input type="email" id="signupEmail" placeholder="Email"><br>
  <input type="password" id="signupPassword" placeholder="Password"><br>
  <input type="text" id="signupNumber" placeholder="Phone Number"><br>
  <input type="text" id="signupPurok" placeholder="Purok"><br>
  <input type="text" id="signupGuardian" placeholder="Parent/Guardian"><br>
  <input type="text" id="signupGuardianPhone" placeholder="Guardian Phone"><br>
  <button class="btn-primary" onclick="signup()">Sign Up</button>
  <p>Already have an account? <a href="#" onclick="showLogin()">Login</a></p>
</div>

<!-- Login Form -->
<div id="loginDiv" class="panel">
  <h2>Login</h2>
  <input type="email" id="loginEmail" placeholder="Email"><br>
  <input type="password" id="loginPassword" placeholder="Password"><br>
  <button class="btn-primary" onclick="login()">Login</button>
  <p>Don‚Äôt have an account? <a href="#" onclick="showSignup()">Sign Up</a></p>
</div>

<!-- Grades Panel -->
<div id="gradesPanel" class="panel">
  <span class="close-btn" onclick="closePanel('gradesPanel')">‚ùå</span>
  <h3>Grades</h3>
  <table id="gradesTable">
    <thead>
      <tr>
        <th>Student</th>
        <th>Level</th>
        <th>Section</th>
        <th>Subject</th>
        <th>Grade</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <div id="addGradeSection" style="margin-top:15px;">
    <input type="text" id="gradeStudent" placeholder="Student Name"><br>
    <input type="text" id="gradeLevel" placeholder="Level"><br>
    <input type="text" id="gradeSection" placeholder="Section"><br>
    <input type="text" id="gradeSubject" placeholder="Subject"><br>
    <input type="text" id="gradeValue" placeholder="Grade"><br>
    <button class="btn-primary" onclick="addGrade()">Add Grade</button>
  </div>
</div>

<!-- All Users Panel -->
<div id="usersPanel" class="panel">
  <span class="close-btn" onclick="closePanel('usersPanel')">‚ùå</span>
  <h3>All Users</h3>
  <table id="usersTable">
    <thead>
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Phone</th>
        <th>Purok</th>
        <th>Guardian</th>
        <th>Guardian Phone</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- Add Admin Panel -->
<div id="addAdminPanel" class="panel">
  <span class="close-btn" onclick="closePanel('addAdminPanel')">‚ùå</span>
  <h3>Add Admin</h3>
  <input type="email" id="newAdminEmail" placeholder="Admin Email"><br>
  <input type="password" id="newAdminPassword" placeholder="Password"><br>
  <button class="btn-primary" onclick="addAdmin()">Create Admin</button>
</div>

<!-- Delete Member Panel -->
<div id="deleteMemberPanel" class="panel">
  <span class="close-btn" onclick="closePanel('deleteMemberPanel')">‚ùå</span>
  <h3>Delete Member</h3>
  <table id="deleteUsersTable">
    <thead>
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- My Info Panel -->
<div id="infoPanel" class="panel">
  <span class="close-btn" onclick="closePanel('infoPanel')">‚ùå</span>
  <h3>My Information</h3>
  <input type="text" id="infoName" placeholder="Full Name"><br>
  <input type="text" id="infoNumber" placeholder="Phone Number"><br>
  <input type="text" id="infoPurok" placeholder="Purok"><br>
  <input type="text" id="infoGuardian" placeholder="Parent/Guardian"><br>
  <input type="text" id="infoGuardianPhone" placeholder="Guardian Phone"><br>
  <button class="btn-primary" onclick="updateInfo()">Update Info</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, setDoc, doc, updateDoc, deleteDoc, query, where } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

// ‚úÖ Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyCYPONQgJC33Lp2OmMyKw4hssDStEwvPlQ",
  authDomain: "test-9c727.firebaseapp.com",
  projectId: "test-9c727",
  storageBucket: "test-9c727.firebasestorage.app",
  messagingSenderId: "198578631587",
  appId: "1:198578631587:web:c0831122f964d46149e016"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// ‚úÖ Toggle panels
function openPanel(id) {
  document.querySelectorAll(".panel").forEach(p => p.style.display="none");
  document.getElementById(id).style.display="block";
}
function closePanel(id) { document.getElementById(id).style.display="none"; }
document.getElementById("menuBtn").onclick = () => {
  let menu = document.getElementById("sideMenu");
  menu.style.left = menu.style.left === "0px" ? "-250px" : "0px";
};

// ‚úÖ Show login/signup
window.showLogin = ()=>{ document.getElementById("signupDiv").style.display="none"; document.getElementById("loginDiv").style.display="block"; }
window.showSignup = ()=>{ document.getElementById("loginDiv").style.display="none"; document.getElementById("signupDiv").style.display="block"; }

// ‚úÖ Signup
window.signup = async ()=>{
  const name = document.getElementById("signupName").value;
  const email = document.getElementById("signupEmail").value;
  const pass = document.getElementById("signupPassword").value;
  const number = document.getElementById("signupNumber").value;
  const purok = document.getElementById("signupPurok").value;
  const guardian = document.getElementById("signupGuardian").value;
  const guardianPhone = document.getElementById("signupGuardianPhone").value;

  try {
    await createUserWithEmailAndPassword(auth,email,pass);
    await setDoc(doc(db,"users",email),{
      name,email,number,purok,guardian,guardianPhone,level:"student",section:""
    });
    alert("Signup success! Now login.");
    showLogin();
  } catch(err){ alert(err.message); }
}

// ‚úÖ Login
window.login = async ()=>{
  const email=document.getElementById("loginEmail").value;
  const pass=document.getElementById("loginPassword").value;
  try { await signInWithEmailAndPassword(auth,email,pass); }
  catch(err){ alert(err.message); }
}

// ‚úÖ Logout
window.logout = async ()=>{ await signOut(auth); location.reload(); }

// ‚úÖ Auth state
onAuthStateChanged(auth, async user=>{
  if(user){
    document.getElementById("signupDiv").style.display="none";
    document.getElementById("loginDiv").style.display="none";
    document.getElementById("sideMenu").style.left="0px";

    // get user data
    const snapshot = await getDocs(query(collection(db,"users"), where("email","==",user.email)));
    snapshot.forEach(d=>{
      let data=d.data();
      if(data.level==="admin"){
        loadAllGrades();
        loadAllUsers();
        loadDeleteUsers();
      }else{
        loadMyGrades(user.email);
        loadMyInfo(user.email);
      }
    });
  }
});

// ‚úÖ Add Grade
window.addGrade = async ()=>{
  const student=document.getElementById("gradeStudent").value;
  const level=document.getElementById("gradeLevel").value;
  const section=document.getElementById("gradeSection").value;
  const subject=document.getElementById("gradeSubject").value;
  const grade=document.getElementById("gradeValue").value;
  await addDoc(collection(db,"grades"),{student,level,section,subject,grade});
  alert("Grade added!");
  loadAllGrades();
}

// ‚úÖ Load All Grades
async function loadAllGrades(){
  const tbody=document.querySelector("#gradesTable tbody");
  tbody.innerHTML="";
  const snap=await getDocs(collection(db,"grades"));
  snap.forEach(doc=>{
    let g=doc.data();
    let tr=document.createElement("tr");
    tr.innerHTML=`<td>${g.student}</td><td>${g.level}</td><td>${g.section}</td><td>${g.subject}</td><td>${g.grade}</td>`;
    tbody.appendChild(tr);
  });
}

// ‚úÖ Load My Grades
async function loadMyGrades(email){
  const tbody=document.querySelector("#gradesTable tbody");
  tbody.innerHTML="";
  const q=query(collection(db,"grades"),where("student","==",email));
  const snap=await getDocs(q);
  snap.forEach(doc=>{
    let g=doc.data();
    let tr=document.createElement("tr");
    tr.innerHTML=`<td>${g.student}</td><td>${g.level}</td><td>${g.section}</td><td>${g.subject}</td><td>${g.grade}</td>`;
    tbody.appendChild(tr);
  });
}

// ‚úÖ Load Users
async function loadAllUsers(){
  const tbody=document.querySelector("#usersTable tbody");
  tbody.innerHTML="";
  const snap=await getDocs(collection(db,"users"));
  snap.forEach(doc=>{
    let u=doc.data();
    let tr=document.createElement("tr");
    tr.innerHTML=`<td>${u.name||""}</td><td>${u.email}</td><td>${u.number||""}</td><td>${u.purok||""}</td><td>${u.guardian||""}</td><td>${u.guardianPhone||""}</td>`;
    tbody.appendChild(tr);
  });
}

// ‚úÖ Delete Member
async function loadDeleteUsers(){
  const tbody=document.querySelector("#deleteUsersTable tbody");
  tbody.innerHTML="";
  const snap=await getDocs(collection(db,"users"));
  snap.forEach(docu=>{
    let u=docu.data();
    let tr=document.createElement("tr");
    tr.innerHTML=`<td>${u.name||""}</td><td>${u.email}</td>
      <td><button onclick="deleteMember('${docu.id}')">Delete</button></td>`;
    tbody.appendChild(tr);
  });
}
window.deleteMember=async(id)=>{
  if(confirm("Are you sure to delete?")){
    await deleteDoc(doc(db,"users",id));
    alert("Deleted!");
    loadDeleteUsers();
  }
}

// ‚úÖ Add Admin
window.addAdmin = async ()=>{
  const email=document.getElementById("newAdminEmail").value;
  const pass=document.getElementById("newAdminPassword").value;
  try{
    await createUserWithEmailAndPassword(auth,email,pass);
    await setDoc(doc(db,"users",email),{email,level:"admin"});
    alert("Admin added!");
    loadAllUsers();
  }catch(err){ alert(err.message); }
}

// ‚úÖ My Info
async function loadMyInfo(email){
  const q=query(collection(db,"users"),where("email","==",email));
  const snap=await getDocs(q);
  snap.forEach(d=>{
    let u=d.data();
    document.getElementById("infoName").value=u.name||"";
    document.getElementById("infoNumber").value=u.number||"";
    document.getElementById("infoPurok").value=u.purok||"";
    document.getElementById("infoGuardian").value=u.guardian||"";
    document.getElementById("infoGuardianPhone").value=u.guardianPhone||"";
  });
}
window.updateInfo = async ()=>{
  const user=auth.currentUser;
  if(!user) return;
  await setDoc(doc(db,"users",user.email),{
    name:document.getElementById("infoName").value,
    email:user.email,
    number:document.getElementById("infoNumber").value,
    purok:document.getElementById("infoPurok").value,
    guardian:document.getElementById("infoGuardian").value,
    guardianPhone:document.getElementById("infoGuardianPhone").value,
    level:"student"
  });
  alert("Info updated!");
}
</script>
</body>
    </html>
