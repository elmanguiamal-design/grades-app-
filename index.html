<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DANHS School Grades</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background: #f4f6f8; }
  h1,h2,h3 { margin: 10px 0; }
  input, select, button { padding:8px; margin:5px 0; border-radius:5px; border:1px solid #ccc; font-size:14px; }
  button { cursor:pointer; background:#4CAF50; color:#fff; border:none; transition:0.3s; }
  button:hover { background:#45a049; }
  .panel { display:none; padding:20px; background:#fff; margin:20px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.2); }
  table { width:100%; border-collapse:collapse; margin-top:10px; }
  table, th, td { border:1px solid #ccc; }
  th, td { padding:8px; text-align:center; }
  tr:nth-child(even){background-color:#f9f9f9;}
  .menu { width:250px; background:#fff; position:fixed; top:0; left:-250px; height:100%; padding:20px; box-shadow:2px 0 5px rgba(0,0,0,0.2); overflow:auto; transition:0.3s; }
  #hamburgerBtn { position:fixed; top:15px; right:15px; font-size:24px; background:#4CAF50; color:#fff; border:none; border-radius:50%; width:50px; height:50px; cursor:pointer; display:none; }
  @media(max-width:768px){ .panel{margin:10px;} }
  .strength { font-size:12px; color:red; }
  #logoutBtn { display:none; padding:8px 15px; margin:10px; border-radius:5px; background:#f44336; color:#fff; border:none; }
  #logoutBtn:hover { background:#da190b; }
  .passed{color:green;font-weight:bold;} .failed{color:red;font-weight:bold;}
</style>
</head>
<body>

<h1>DANHS School Grades</h1>

<!-- Signup Form -->
<div id="signupDiv" class="panel">
  <h2>Sign Up</h2>
  <input type="email" id="signupEmail" placeholder="Email">
  <input type="password" id="signupPassword" placeholder="Password">
  <div class="strength" id="passwordStrength">Password strength: </div>
  <button onclick="signup()">Sign Up</button>
  <p>Already have an account? <a href="#" onclick="switchToLogin()">Login here</a></p>
</div>

<!-- Login Form -->
<div id="loginDiv" class="panel">
  <h2>Login</h2>
  <input type="email" id="loginEmail" placeholder="Email">
  <input type="password" id="loginPassword" placeholder="Password">
  <button onclick="login()">Login</button>
  <p>Don't have an account? <a href="#" onclick="switchToSignup()">Sign up</a></p>
</div>

<!-- Hamburger Button -->
<button id="hamburgerBtn">&#9776;</button>

<!-- Side Menu -->
<div class="menu" id="sideMenu">
  <h3>Menu</h3>
  <button onclick="showPanel('gradesPanel')">Grades</button>
  <button onclick="showPanel('adminPanel')">Admin Panel</button>
  <button onclick="showPanel('infoPanel')">My Info</button>
</div>

<!-- Logout Button -->
<button id="logoutBtn">Logout</button>

<!-- Grades Panel -->
<div id="gradesPanel" class="panel">
  <h2>Grades</h2>
  <table id="gradesTable">
    <thead>
      <tr>
        <th>Student</th>
        <th>Level</th>
        <th>Section</th>
        <th>Subject</th>
        <th>Grade</th>
        <th>Remark</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- Admin Panel -->
<div id="adminPanel" class="panel">
  <h2>Admin Panel</h2>

  <h3>Users List</h3>
  <input type="text" id="searchUser" placeholder="Search Users" oninput="filterUsers()">
  <table id="usersTable">
    <thead>
      <tr>
        <th>Email</th>
        <th>Level</th>
        <th>Section</th>
        <th>Name</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h3>Add / Update Grades</h3>
  <input type="text" id="studentName" placeholder="Student Name">
  <select id="studentLevel">
    <option value="">Select Level</option>
    <option value="7">7</option><option value="8">8</option>
    <option value="9">9</option><option value="10">10</option>
    <option value="11">11</option><option value="12">12</option>
  </select>
  <select id="studentSection">
    <option value="">Select Section</option>
    <option value="A">A</option><option value="B">B</option>
    <option value="C">C</option><option value="D">D</option>
  </select>
  <input type="text" id="studentSubject" placeholder="Subject">
  <input type="number" id="studentGrade" placeholder="Grade">
  <button onclick="addOrUpdateGrade()">Add / Update Grade</button>

  <h3>Create New Admin</h3>
  <input type="email" id="newAdminEmail" placeholder="Admin Email">
  <input type="password" id="newAdminPassword" placeholder="Password">
  <div class="strength" id="newAdminStrength">Password strength: </div>
  <button onclick="createAdmin()">Create Admin</button>
</div>

<!-- My Info Panel -->
<div id="infoPanel" class="panel">
  <h2>My Information</h2>
  <input type="text" id="infoName" placeholder="Name">
  <input type="text" id="infoNumber" placeholder="Mobile Number">
  <input type="text" id="infoPurok" placeholder="Purok">
  <input type="text" id="infoGuardian" placeholder="Parent/Guardian">
  <input type="text" id="infoGuardianNumber" placeholder="Parent/Guardian Phone">
  <button onclick="saveInfo()">Save Info</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, query, where } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

// ---------------------- Firebase Config ----------------------
const firebaseConfig = {
  apiKey: "AIzaSyCYPONQgJC33Lp2OmMyKw4hssDStEwvPlQ",
  authDomain: "test-9c727.firebaseapp.com",
  projectId: "test-9c727",
  storageBucket: "test-9c727.appspot.com",
  messagingSenderId: "198578631587",
  appId: "1:198578631587:web:c0831122f964d46149e016"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// ---------------------- Password Strength ----------------------
const signupPassword = document.getElementById("signupPassword");
const passwordStrength = document.getElementById("passwordStrength");
signupPassword.addEventListener("input", ()=>{
  passwordStrength.innerText = signupPassword.value.length>=6 ? "Password strength: Strong" : "Password strength: Weak";
});

const newAdminPass = document.getElementById("newAdminPassword");
const newAdminStrength = document.getElementById("newAdminStrength");
newAdminPass.addEventListener("input", ()=>{
  newAdminStrength.innerText = newAdminPass.value.length>=6 ? "Password strength: Strong" : "Password strength: Weak";
});

// ---------------------- Signup Function ----------------------
window.signup = async ()=>{
  const email = document.getElementById("signupEmail").value;
  const password = signupPassword.value;
  if(password.length<6){ alert("Password too short"); return; }
  try{
    await createUserWithEmailAndPassword(auth,email,password);
    await addDoc(collection(db,"users"),{email, level:"7", section:"A", name:"", number:"", purok:"", guardian:"", guardianNumber:""});
    alert("Signup successful! Ask admin to update level/section.");
  }catch(err){ alert("Firebase error: "+err.message); }
}

// ---------------------- Switch Panels ----------------------
window.switchToLogin = ()=>{ document.getElementById("signupDiv").style.display="none"; document.getElementById("loginDiv").style.display="block"; }
window.switchToSignup = ()=>{ document.getElementById("loginDiv").style.display="none"; document.getElementById("signupDiv").style.display="block"; }

// ---------------------- Login Function ----------------------
window.login = async ()=>{
  const email = document.getElementById("loginEmail").value;
  const password = document.getElementById("loginPassword").value;
  try{
    await signInWithEmailAndPassword(auth,email,password);
  }catch(err){ alert("Firebase error: "+err.message); }
}

  <script type="module">
// ---------------------- Hamburger Menu ----------------------
const hamburgerBtn = document.getElementById("hamburgerBtn");
const sideMenu = document.getElementById("sideMenu");

hamburgerBtn.addEventListener("click", ()=>{
  if(sideMenu.style.left === "0px"){ sideMenu.style.left = "-250px"; }
  else{ sideMenu.style.left = "0px"; }
});

// ---------------------- Logout ----------------------
document.getElementById("logoutBtn").addEventListener("click", async ()=>{
  await signOut(auth);
  location.reload();
});

// ---------------------- Show Panel ----------------------
function showPanel(panelId){
  const panels = ["gradesPanel","adminPanel","infoPanel"];
  panels.forEach(p=>{ document.getElementById(p).style.display="none"; });
  document.getElementById(panelId).style.display="block";
}

// ---------------------- Auth State ----------------------
onAuthStateChanged(auth, async user=>{
  if(user){
    document.getElementById("signupDiv").style.display="none";
    document.getElementById("loginDiv").style.display="none";
    hamburgerBtn.style.display="block";
    document.getElementById("logoutBtn").style.display="block";

    const usersRef = collection(db,"users");
    const q = query(usersRef, where("email","==",user.email));
    const snapshot = await getDocs(q);
    snapshot.forEach(async docu=>{
      const data = docu.data();
      if(data.level==="admin"){
        document.getElementById("adminPanel").style.display="block";
        loadUsers();
        loadGradesAll();
      } else {
        showPanel("gradesPanel");
        loadGrades(data.level,data.section,user.email);
      }
    });
  } else {
    document.getElementById("signupDiv").style.display="block";
    document.getElementById("loginDiv").style.display="block";
    hamburgerBtn.style.display="none";
    document.getElementById("logoutBtn").style.display="none";
    document.getElementById("gradesPanel").style.display="none";
    document.getElementById("adminPanel").style.display="none";
    document.getElementById("infoPanel").style.display="none";
  }
});

// ---------------------- Load Users (Admin) ----------------------
async function loadUsers(){
  const tbody = document.querySelector("#usersTable tbody");
  tbody.innerHTML="";
  const snapshot = await getDocs(collection(db,"users"));
  snapshot.forEach(doc=>{
    const data = doc.data();
    const tr = document.createElement("tr");
    tr.innerHTML=`<td>${data.email}</td><td>${data.level}</td><td>${data.section}</td><td>${data.name || ""}</td>
      <td><button onclick="deleteUser('${doc.id}')">Delete</button></td>`;
    tbody.appendChild(tr);
  });
}

// ---------------------- Delete User ----------------------
window.deleteUser = async (id)=>{
  if(confirm("Are you sure you want to delete this user?")){
    await deleteDoc(doc(db,"users",id));
    alert("User deleted!");
    loadUsers();
  }
}

// ---------------------- Filter Users ----------------------
window.filterUsers = ()=>{
  const filter = document.getElementById("searchUser").value.toLowerCase();
  const rows = document.querySelectorAll("#usersTable tbody tr");
  rows.forEach(r=>{
    r.style.display = r.innerText.toLowerCase().includes(filter)? "":"none";
  });
}

// ---------------------- Load Grades ----------------------
async function loadGradesAll(){
  const tbody = document.querySelector("#gradesTable tbody");
  tbody.innerHTML="";
  const snapshot = await getDocs(collection(db,"grades"));
  snapshot.forEach(doc=>{
    const d=doc.data();
    const remark = d.grade>=75 ? "Passed":"Failed";
    const tr = document.createElement("tr");
    tr.innerHTML=`<td>${d.student}</td><td>${d.level}</td><td>${d.section}</td><td>${d.subject}</td><td>${d.grade}</td><td class="${remark.toLowerCase()}">${remark}</td>`;
    tbody.appendChild(tr);
  });
}

async function loadGrades(level,section,email){
  const tbody = document.querySelector("#gradesTable tbody");
  tbody.innerHTML="";
  const q = query(collection(db,"grades"), where("level","==",level), where("section","==",section));
  const snapshot = await getDocs(q);
  snapshot.forEach(doc=>{
    const d=doc.data();
    const remark = d.grade>=75 ? "Passed":"Failed";
    const tr = document.createElement("tr");
    tr.innerHTML=`<td>${d.student}</td><td>${d.level}</td><td>${d.section}</td><td>${d.subject}</td><td>${d.grade}</td><td class="${remark.toLowerCase()}">${remark}</td>`;
    tbody.appendChild(tr);
  });
}

// ---------------------- Add / Update Grades ----------------------
window.addOrUpdateGrade = async ()=>{
  const name = document.getElementById("studentName").value;
  const level = document.getElementById("studentLevel").value;
  const section = document.getElementById("studentSection").value;
  const subject = document.getElementById("studentSubject").value;
  const grade = Number(document.getElementById("studentGrade").value);

  const gradesRef = collection(db,"grades");
  const q = query(gradesRef, where("student","==",name), where("subject","==",subject), where("level","==",level), where("section","==",section));
  const snapshot = await getDocs(q);

  if(!snapshot.empty){
    snapshot.forEach(async docu=>{
      await updateDoc(doc(db,"grades",docu.id),{grade});
    });
    alert("Grade updated!");
  } else {
    await addDoc(gradesRef,{student:name,level,section,subject,grade});
    alert("Grade added!");
  }
  loadGradesAll();
}

// ---------------------- Create Admin ----------------------
window.createAdmin = async ()=>{
  const email = document.getElementById("newAdminEmail").value;
  const password = newAdminPass.value;
  if(password.length<6){ alert("Password too short"); return; }
  try{
    await createUserWithEmailAndPassword(auth,email,password);
    await addDoc(collection(db,"users"),{email,level:"admin",section:"", name:"", number:"", purok:"", guardian:"", guardianNumber:""});
    alert("New admin created!");
    document.getElementById("newAdminEmail").value="";
    newAdminPass.value="";
    newAdminStrength.innerText="Password strength:";
    loadUsers();
  }catch(err){ alert("Firebase error: "+err.message); }
}

// ---------------------- Save My Info ----------------------
window.saveInfo = async ()=>{
  const email = auth.currentUser.email;
  const q = query(collection(db,"users"), where("email","==",email));
  const snapshot = await getDocs(q);
  snapshot.forEach(async docu=>{
    await updateDoc(doc(db,"users",docu.id),{
      name: document.getElementById("infoName").value,
      number: document.getElementById("infoNumber").value,
      purok: document.getElementById("infoPurok").value,
      guardian: document.getElementById("infoGuardian").value,
      guardianNumber: document.getElementById("infoGuardianNumber").value
    });
    alert("Information updated!");
  });
}
</script>
</body>
</html>
