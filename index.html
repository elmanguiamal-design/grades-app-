<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DANHS School Grades</title>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f9f9f9; }
h1 { text-align:center; margin:20px 0; }
input, select, button { margin:5px 0; padding:8px; border-radius:6px; border:1px solid #ccc; width:100%; }
button { cursor:pointer; background:#4CAF50; color:white; border:none; }
button:hover { background:#45a049; }
table { border-collapse: collapse; width:100%; margin-top:10px; background:white; }
th, td { border:1px solid #ddd; padding:8px; text-align:center; }
th { background:#f2f2f2; }
.strength { font-size:12px; color:red; }

/* Hamburger menu */
#menuBtn { font-size:22px; cursor:pointer; margin:10px; }
#sideMenu {
  height:100%; width:0; position:fixed; top:0; left:0; background:#333; 
  overflow-x:hidden; transition:0.3s; padding-top:60px; z-index:1000;
}
#sideMenu a, #sideMenu button {
  padding:10px 15px; text-decoration:none; font-size:18px; color:white; display:block; border:none; background:none; text-align:left;
}
#sideMenu a:hover, #sideMenu button:hover { background:#575757; }
#sideMenu .closeBtn {
  position:absolute; top:10px; right:20px; font-size:28px; background:none; color:white; border:none; cursor:pointer;
}

/* Panels */
.panel { display:none; padding:20px; margin:20px; background:white; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.2); }
.closePanel { float:right; background:#e74c3c; color:white; border:none; padding:4px 8px; cursor:pointer; border-radius:4px; }

/* Center forms */
#signupDiv, #loginDiv { max-width:350px; margin:20px auto; background:white; padding:20px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.2); }
</style>
</head>
<body>

<h1>DANHS School Grades</h1>

<!-- Hamburger button -->
<span id="menuBtn" onclick="openMenu()">‚ò∞ Menu</span>

<!-- Side Menu -->
<div id="sideMenu">
  <button class="closeBtn" onclick="closeMenu()">‚ùå</button>
  <button onclick="showPanel('gradesPanel')">üìä Grades</button>
  <button onclick="showPanel('usersPanel')">üë• All Users</button>
  <button onclick="showPanel('addAdminPanel')">‚ûï Add Admin</button>
  <button onclick="showPanel('deletePanel')">üóëÔ∏è Delete Member</button>
  <button onclick="showPanel('infoPanel')">‚öôÔ∏è My Info</button>
  <button onclick="logout()">üö™ Logout</button>
</div>

<!-- Signup Form -->
<div id="signupDiv">
  <h2>Signup</h2>
  <input type="email" id="signupEmail" placeholder="Email">
  <input type="password" id="signupPassword" placeholder="Password">
  <button type="button" id="togglePassword">Show Password</button>
  <div class="strength" id="passwordStrength">Password strength: </div>
  <button onclick="signup()">Sign Up</button>
  <p>Already have account? <a href="#" onclick="toggleLogin()">Login here</a></p>
</div>

<!-- Login Form -->
<div id="loginDiv" style="display:none;">
  <h2>Login</h2>
  <input type="email" id="loginEmail" placeholder="Email">
  <input type="password" id="loginPassword" placeholder="Password">
  <button type="button" id="toggleLoginPassword">Show Password</button>
  <button onclick="login()">Login</button>
  <p>Don‚Äôt have account? <a href="#" onclick="toggleSignup()">Signup here</a></p>
</div>

<!-- Panels -->
<div id="gradesPanel" class="panel">
  <button class="closePanel" onclick="closePanel('gradesPanel')">‚ùå Close</button>
  <h2>Grades</h2>
  <table id="gradesTable">
    <thead>
      <tr><th>Student</th><th>Level</th><th>Section</th><th>Subject</th><th>Grade</th><th>Remarks</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <h3>Add / Update Grade</h3>
  <input type="text" id="studentName" placeholder="Student Name">
  <select id="studentLevel">
    <option value="">Select Level</option>
    <option value="7">7</option><option value="8">8</option>
    <option value="9">9</option><option value="10">10</option>
    <option value="11">11</option><option value="12">12</option>
  </select>
  <select id="studentSection">
    <option value="">Select Section</option>
    <option value="A">A</option><option value="B">B</option>
    <option value="C">C</option><option value="D">D</option>
  </select>
  <input type="text" id="studentSubject" placeholder="Subject">
  <input type="number" id="studentGrade" placeholder="Grade">
  <button onclick="addOrUpdateGrade()">Add / Update Grade</button>
    </div>

  <!-- Users Panel -->
<div id="usersPanel" class="panel">
  <button class="closePanel" onclick="closePanel('usersPanel')">‚ùå Close</button>
  <h2>All Users</h2>
  <ul id="usersList"></ul>
</div>

<!-- Add Admin Panel -->
<div id="addAdminPanel" class="panel">
  <button class="closePanel" onclick="closePanel('addAdminPanel')">‚ùå Close</button>
  <h2>Add Admin</h2>
  <input type="email" id="newAdminEmail" placeholder="Enter user email">
  <button onclick="addAdmin()">Add Admin</button>
</div>

<!-- Delete Member Panel -->
<div id="deletePanel" class="panel">
  <button class="closePanel" onclick="closePanel('deletePanel')">‚ùå Close</button>
  <h2>Delete Member</h2>
  <input type="email" id="deleteEmail" placeholder="Enter user email">
  <button onclick="deleteMember()">Delete</button>
</div>

<!-- Info Panel -->
<div id="infoPanel" class="panel">
  <button class="closePanel" onclick="closePanel('infoPanel')">‚ùå Close</button>
  <h2>My Info</h2>
  <input type="text" id="userName" placeholder="Your name">
  <input type="text" id="userLevel" placeholder="Your level">
  <input type="text" id="userSection" placeholder="Your section">
  <button onclick="saveInfo()">Save Info</button>
</div>

<script type="module">
  // Import Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, 
           signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
  import { getFirestore, collection, setDoc, doc, getDocs, getDoc, updateDoc, deleteDoc } 
          from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  // Your Firebase config (replace with yours)
  const firebaseConfig = {
    apiKey: "AIzaSyCYPONQgJC33Lp2OmMyKw4hssDStEwvPlQ",
    authDomain: "test-9c727.firebaseapp.com",
    projectId: "test-9c727",
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // Menu functions
  function openMenu(){ document.getElementById("sideMenu").style.width="250px"; }
  function closeMenu(){ document.getElementById("sideMenu").style.width="0"; }

  // Panel functions
  function showPanel(id){
    document.querySelectorAll('.panel').forEach(p=>p.style.display="none");
    document.getElementById(id).style.display="block";
    closeMenu();
  }
  function closePanel(id){ document.getElementById(id).style.display="none"; }

  // Switch forms
  window.toggleLogin = ()=>{ document.getElementById("signupDiv").style.display="none"; document.getElementById("loginDiv").style.display="block"; }
  window.toggleSignup = ()=>{ document.getElementById("loginDiv").style.display="none"; document.getElementById("signupDiv").style.display="block"; }

  // Signup
  window.signup = async ()=>{
    const email=document.getElementById("signupEmail").value;
    const password=document.getElementById("signupPassword").value;
    try{
      await createUserWithEmailAndPassword(auth,email,password);
      alert("Signup successful! Please login.");
      toggleLogin();
    }catch(e){ alert(e.message); }
  }

  // Login
  window.login = async ()=>{
    const email=document.getElementById("loginEmail").value;
    const password=document.getElementById("loginPassword").value;
    try{
      await signInWithEmailAndPassword(auth,email,password);
    }catch(e){ alert(e.message); }
  }

  // Logout
  window.logout = async ()=>{
    await signOut(auth);
    document.getElementById("loginDiv").style.display="block";
    document.getElementById("signupDiv").style.display="none";
    document.querySelectorAll('.panel').forEach(p=>p.style.display="none");
  }

  // Auth state
  onAuthStateChanged(auth, user=>{
    if(user){
      document.getElementById("loginDiv").style.display="none";
      document.getElementById("signupDiv").style.display="none";
      showPanel("gradesPanel");
    }else{
      document.getElementById("loginDiv").style.display="block";
      document.getElementById("signupDiv").style.display="none";
    }
  });

  // Add or update grade
  window.addOrUpdateGrade = async ()=>{
    const name=document.getElementById("studentName").value;
    const level=document.getElementById("studentLevel").value;
    const section=document.getElementById("studentSection").value;
    const subject=document.getElementById("studentSubject").value;
    const grade=document.getElementById("studentGrade").value;

    if(!name || !level || !section || !subject || !grade){ alert("Fill all fields!"); return; }

    const ref=doc(db,"grades",`${name}_${subject}`);
    await setDoc(ref,{name,level,section,subject,grade});
    alert("Grade added/updated!");
    loadGrades();
  }

  async function loadGrades(){
    const tbody=document.querySelector("#gradesTable tbody");
    tbody.innerHTML="";
    const snap=await getDocs(collection(db,"grades"));
    snap.forEach(docu=>{
      const d=docu.data();
      const remarks=(d.grade>=75)?"‚úÖ Passed":"‚ùå Failed";
      const row=`<tr>
        <td>${d.name}</td><td>${d.level}</td><td>${d.section}</td>
        <td>${d.subject}</td><td>${d.grade}</td><td>${remarks}</td>
      </tr>`;
      tbody.innerHTML+=row;
    });
  }
  loadGrades();

  // Add Admin
  window.addAdmin=async()=>{
    const email=document.getElementById("newAdminEmail").value;
    if(!email) return alert("Enter email");
    await setDoc(doc(db,"admins",email),{email});
    alert("Admin added!");
  }

  // Delete Member
  window.deleteMember=async()=>{
    const email=document.getElementById("deleteEmail").value;
    if(!email) return alert("Enter email");
    await deleteDoc(doc(db,"users",email));
    alert("Member deleted!");
  }

  // Save Info
  window.saveInfo=async()=>{
    const user=auth.currentUser;
    if(!user) return;
    const name=document.getElementById("userName").value;
    const level=document.getElementById("userLevel").value;
    const section=document.getElementById("userSection").value;
    await setDoc(doc(db,"users",user.uid),{name,level,section});
    alert("Info saved!");
  }
</script>

</body>
    </html>
