<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DANHS School Grades</title>
<style>
body {
  font-family: Arial, sans-serif;
  margin: 0; padding: 0;
}
header {
  background: #2c3e50;
  color: white;
  padding: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
#hamburger {
  font-size: 24px;
  cursor: pointer;
}
#sideMenu {
  position: fixed;
  top: 0; left: -260px;
  width: 250px; height: 100%;
  background: #ecf0f1;
  padding: 20px;
  transition: 0.3s;
  box-shadow: 2px 0 5px rgba(0,0,0,0.3);
  z-index: 1000;
}
#sideMenu.open { left: 0; }
#sideMenu button, #sideMenu a {
  display: block;
  width: 100%;
  padding: 10px;
  margin: 5px 0;
  background: #3498db;
  color: white;
  border: none;
  text-align: left;
  cursor: pointer;
  border-radius: 5px;
}
#sideMenu button:hover, #sideMenu a:hover {
  background: #2980b9;
}
.container {
  padding: 20px;
}
input, select, button {
  padding: 8px;
  margin: 5px 0;
  width: 100%;
  max-width: 400px;
  display: block;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
}
table, th, td {
  border: 1px solid #333;
}
th, td {
  padding: 8px;
  text-align: center;
}
.strength { font-size: 12px; color: red; }

/* Responsive Design */
@media(max-width: 600px) {
  header h1 { font-size: 18px; }
  table, th, td { font-size: 12px; }
}
</style>
</head>
<body>

<header>
  <h1>DANHS School Grades</h1>
  <div id="hamburger" onclick="openMenu()">‚ò∞</div>
</header>

<!-- Side Menu -->
<div id="sideMenu">
  <button onclick="closeMenu()">‚ùå Close</button>
  <button onclick="showPanel('gradesContainer')">üìñ Grades</button>
  <button onclick="showPanel('adminPanel')">‚öôÔ∏è Admin Panel</button>
  <button onclick="showPanel('infoPanel')">üë§ My Information</button>
  <button id="logoutBtn">üö™ Logout</button>
</div>

<div class="container">

  <!-- Signup Form -->
  <div id="signupDiv">
    <h2>Signup</h2>
    <input type="text" id="signupName" placeholder="Full Name">
    <input type="email" id="signupEmail" placeholder="Email">
    <input type="password" id="signupPassword" placeholder="Password">
    <button type="button" id="togglePassword">Show Password</button>
    <div class="strength" id="passwordStrength">Password strength: </div>
    <button onclick="signup()">Sign Up</button>
    <p>Already have an account? <a href="#" onclick="toggleForms()">Login</a></p>
  </div>

  <!-- Login Form -->
  <div id="loginDiv" style="display:none;">
    <h2>Login</h2>
    <input type="email" id="loginEmail" placeholder="Email">
    <input type="password" id="loginPassword" placeholder="Password">
    <button type="button" id="toggleLoginPassword">Show Password</button>
    <button onclick="login()">Login</button>
    <p>Don't have an account? <a href="#" onclick="toggleForms()">Sign Up</a></p>
  </div>

  <!-- Admin Panel -->
  <div id="adminPanel" style="display:none;">
    <h2>Admin Panel</h2>

    <h3>All Users</h3>
    <table id="usersTable">
      <thead>
        <tr>
          <th>Email</th><th>Name</th><th>Level</th><th>Section</th><th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <h3>Add / Update Grades</h3>
    <input type="text" id="studentName" placeholder="Student Name">
    <select id="studentLevel">
      <option value="">Select Level</option>
      <option value="7">7</option><option value="8">8</option>
      <option value="9">9</option><option value="10">10</option>
      <option value="11">11</option><option value="12">12</option>
    </select>
    <select id="studentSection">
      <option value="">Select Section</option>
      <option value="A">A</option><option value="B">B</option>
      <option value="C">C</option><option value="D">D</option>
    </select>
    <input type="text" id="studentSubject" placeholder="Subject">
    <input type="number" id="studentGrade" placeholder="Grade">
    <button onclick="addOrUpdateGrade()">Add / Update Grade</button>

    <h3>Create Admin</h3>
    <input type="email" id="newAdminEmail" placeholder="Admin Email">
    <input type="password" id="newAdminPassword" placeholder="Password">
    <button type="button" id="toggleNewAdminPassword">Show Password</button>
    <div class="strength" id="newAdminStrength">Password strength: </div>
    <button onclick="createAdmin()">Create Admin</button>
  </div>

  <!-- Grades Table -->
  <div id="gradesContainer" style="display:none;">
    <h2>Grades</h2>
    <table id="gradesTable">
      <thead>
        <tr>
          <th>Student</th><th>Level</th><th>Section</th><th>Subject</th><th>Grade</th><th>Remarks</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Info Panel -->
  <div id="infoPanel" style="display:none;">
    <h2>My Information</h2>
    <input type="text" id="infoName" placeholder="Name">
    <input type="text" id="infoNumber" placeholder="Mobile Number">
    <input type="text" id="infoPurok" placeholder="Purok">
    <input type="text" id="infoGuardian" placeholder="Parent/Guardian">
    <input type="text" id="infoGuardianPhone" placeholder="Guardian Phone">
    <button onclick="saveInfo()">Save Info</button>
  </div>

      </div>

  <script type="module">
// Firebase imports
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, query, where } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

// Your Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyCYPONQgJC33Lp2OmMyKw4hssDStEwvPlQ",
  authDomain: "test-9c727.firebaseapp.com",
  projectId: "test-9c727",
  storageBucket: "test-9c727.firebasestorage.app",
  messagingSenderId: "198578631587",
  appId: "1:198578631587:web:c0831122f964d46149e016"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// ========== ALL FUNCTIONS ==========
// Open / Close Menu
window.openMenu = ()=> document.getElementById("sideMenu").classList.add("open");
window.closeMenu = ()=> document.getElementById("sideMenu").classList.remove("open");

// Toggle forms
window.toggleForms = ()=>{
  document.getElementById("signupDiv").style.display =
    document.getElementById("signupDiv").style.display==="none"?"block":"none";
  document.getElementById("loginDiv").style.display =
    document.getElementById("loginDiv").style.display==="none"?"block":"none";
};

// Password strength
const signupPassword = document.getElementById("signupPassword");
const passwordStrength = document.getElementById("passwordStrength");
signupPassword.addEventListener("input", ()=>{
  passwordStrength.innerText = signupPassword.value.length >=6 ? "Password strength: Strong" : "Password strength: Weak";
});
document.getElementById("togglePassword").addEventListener("click", ()=>{
  signupPassword.type = signupPassword.type==="password"?"text":"password";
});

// Login password toggle
document.getElementById("toggleLoginPassword").addEventListener("click", ()=>{
  const loginPass = document.getElementById("loginPassword");
  loginPass.type = loginPass.type==="password"?"text":"password";
});

// New admin password toggle
const newAdminPass = document.getElementById("newAdminPassword");
document.getElementById("toggleNewAdminPassword").addEventListener("click", ()=>{
  newAdminPass.type = newAdminPass.type==="password"?"text":"password";
});

// ========== AUTH ==========
// Signup
window.signup = async ()=>{
  const name = document.getElementById("signupName").value;
  const email = document.getElementById("signupEmail").value;
  const password = document.getElementById("signupPassword").value;
  if(password.length < 6){ alert("Password too short"); return; }
  try{
    await createUserWithEmailAndPassword(auth,email,password);
    await addDoc(collection(db,"users"),{email,name,level:"7",section:"A"});
    alert("Signup successful! Ask admin to update level/section.");
  }catch(err){ alert(err.message); }
};

// Login
window.login = async ()=>{
  const email = document.getElementById("loginEmail").value;
  const password = document.getElementById("loginPassword").value;
  try{
    await signInWithEmailAndPassword(auth,email,password);
  }catch(err){ alert(err.message); }
};

// Logout
document.getElementById("logoutBtn").addEventListener("click", async ()=>{
  await signOut(auth);
  closeMenu();
});

// Auth state
onAuthStateChanged(auth, user=>{
  if(user){
    document.getElementById("signupDiv").style.display="none";
    document.getElementById("loginDiv").style.display="none";
    checkAdmin(user.email);
  }else{
    document.getElementById("signupDiv").style.display="block";
    document.getElementById("loginDiv").style.display="none";
    document.getElementById("gradesContainer").style.display="none";
    document.getElementById("adminPanel").style.display="none";
    document.getElementById("infoPanel").style.display="none";
  }
});

// ========== ADMIN / GRADES / INFO ==========
async function checkAdmin(email){
  const q = query(collection(db,"users"),where("email","==",email));
  const snap = await getDocs(q);
  snap.forEach(d=>{
    const data = d.data();
    if(data.level==="admin"){
      showPanel('adminPanel');
      loadUsers();
      loadGradesAll();
    }else{
      showPanel('gradesContainer');
      loadGrades(data.level,data.section);
    }
  });
}

window.showPanel = function(panelId){
  ["gradesContainer","adminPanel","infoPanel"].forEach(id=>{
    document.getElementById(id).style.display="none";
  });
  document.getElementById(panelId).style.display="block";
  closeMenu();
};

// Load users
async function loadUsers(){
  const tbody = document.querySelector("#usersTable tbody");
  tbody.innerHTML="";
  const snap = await getDocs(collection(db,"users"));
  snap.forEach(u=>{
    const d = u.data();
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${d.email}</td><td>${d.name||""}</td><td>${d.level}</td>
      <td>${d.section}</td>
      <td><button onclick="deleteUser('${u.id}')">Delete</button></td>`;
    tbody.appendChild(tr);
  });
}

// Delete user
window.deleteUser = async(id)=>{
  await deleteDoc(doc(db,"users",id));
  alert("User deleted!");
  loadUsers();
};

// Load all grades
async function loadGradesAll(){
  const tbody = document.querySelector("#gradesTable tbody");
  tbody.innerHTML="";
  const snap = await getDocs(collection(db,"grades"));
  snap.forEach(g=>{
    const d=g.data();
    const remarks = d.grade >= 75 ? "<span style='color:green'>‚úÖ Passed</span>" : "<span style='color:red'>‚ùå Failed</span>";
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${d.student}</td><td>${d.level}</td><td>${d.section}</td>
    <td>${d.subject}</td><td>${d.grade}</td><td>${remarks}</td>`;
    tbody.appendChild(tr);
  });
}

// Load grades for student
async function loadGrades(level,section){
  const tbody = document.querySelector("#gradesTable tbody");
  tbody.innerHTML="";
  const q=query(collection(db,"grades"),where("level","==",level),where("section","==",section));
  const snap=await getDocs(q);
  snap.forEach(g=>{
    const d=g.data();
    const remarks = d.grade >= 75 ? "<span style='color:green'>‚úÖ Passed</span>" : "<span style='color:red'>‚ùå Failed</span>";
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${d.student}</td><td>${d.level}</td><td>${d.section}</td>
    <td>${d.subject}</td><td>${d.grade}</td><td>${remarks}</td>`;
    tbody.appendChild(tr);
  });
}

// Add or update grade
window.addOrUpdateGrade = async()=>{
  const name=document.getElementById("studentName").value;
  const level=document.getElementById("studentLevel").value;
  const section=document.getElementById("studentSection").value;
  const subject=document.getElementById("studentSubject").value;
  const grade=document.getElementById("studentGrade").value;
  const q=query(collection(db,"grades"),where("student","==",name),where("subject","==",subject),where("level","==",level),where("section","==",section));
  const snap=await getDocs(q);
  if(!snap.empty){
    snap.forEach(async g=>{
      await updateDoc(doc(db,"grades",g.id),{grade});
    });
    alert("Grade updated!");
  }else{
    await addDoc(collection(db,"grades"),{student:name,level,section,subject,grade:Number(grade)});
    alert("Grade added!");
  }
  loadGradesAll();
};

// Create admin
window.createAdmin = async()=>{
  const email=document.getElementById("newAdminEmail").value;
  const password=newAdminPass.value;
  if(password.length<6){alert("Password too short");return;}
  try{
    await createUserWithEmailAndPassword(auth,email,password);
    await addDoc(collection(db,"users"),{email,level:"admin",section:"",name:""});
    alert("New admin created!");
    loadUsers();
  }catch(err){alert(err.message);}
};

// Save info
window.saveInfo = async()=>{
  const user=auth.currentUser;
  if(!user)return;
  const q=query(collection(db,"users"),where("email","==",user.email));
  const snap=await getDocs(q);
  snap.forEach(async u=>{
    await updateDoc(doc(db,"users",u.id),{
      name:document.getElementById("infoName").value,
      number:document.getElementById("infoNumber").value,
      purok:document.getElementById("infoPurok").value,
      guardian:document.getElementById("infoGuardian").value,
      guardianPhone:document.getElementById("infoGuardianPhone").value
    });
  });
  alert("Info saved!");
};
</script>
</body>
</html>
